{
  "hash": "21ff26e6b0a0fe4282e6b1943f8bd7fc",
  "result": {
    "markdown": "---\ntitle: In-class Exercise 7\nexecute:\n  freeze: true\n---\n\n### 1.0 Loading of Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sp, spdep, tmap, sf, ClustGeo, \n               ggpubr, cluster, factoextra, NbClust,\n               heatmaply, corrplot, psych, tidyverse, GGally)\n```\n:::\n\n\n### 2.0 Data Loading and Preparation\n\n#### 2.1 Geospatial Myanmar Township Data\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_sf <- read_rds(\"../../Data/Shan/shan_sf.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_sf <- st_read(dsn = \"../../data/myanmar_township_boundary\", \n                   layer = \"myanmar_township_boundaries\") %>%\n  filter(ST %in% c(\"Shan (East)\", \"Shan (North)\", \"Shan (South)\")) %>%\n  select(c(2:7))\n```\n:::\n\n\nWe include the filter function to exclude the other states of Myanmar, so we are only interested in Shan. We also don't want the irrelevant columns, or the columns we don't understand such as those containing the Burmese names.\n\nWe have also carefully selected the columns that share data fields with the aspatial Shan ICT data, which we can inspect through its CSV file. These shared data fields will be used for joining later.\n\n#### 2.2 Aspatial Shan ICT Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nict <- read_csv (\"../../Data/Shan/Shan-ICT.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 55 Columns: 11\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (4): District Pcode, District Name, Township Pcode, Township Name\ndbl (7): Total households, Radio, Television, Land line phone, Mobile phone,...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n#### 2.3 Checking the data\n\nWe run this command to check the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_sf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 55 features and 54 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 96.15107 ymin: 19.29932 xmax: 101.1699 ymax: 24.15907\nGeodetic CRS:  WGS 84\nFirst 10 features:\n             ST ST_PCODE     DT.x DT_PCODE.x      TS.x  TS_PCODE DT_PCODE.y\n1  Shan (North)   MMR015  Mongmit MMR015D008   Mongmit MMR015017 MMR015D003\n2  Shan (South)   MMR014 Taunggyi MMR014D001   Pindaya MMR014006 MMR014D001\n3  Shan (South)   MMR014 Taunggyi MMR014D001   Ywangan MMR014007 MMR014D001\n4  Shan (South)   MMR014 Taunggyi MMR014D001  Pinlaung MMR014009 MMR014D001\n5  Shan (North)   MMR015  Mongmit MMR015D008    Mabein MMR015018 MMR015D003\n6  Shan (South)   MMR014 Taunggyi MMR014D001     Kalaw MMR014005 MMR014D001\n7  Shan (South)   MMR014 Taunggyi MMR014D001     Pekon MMR014010 MMR014D001\n8  Shan (South)   MMR014 Taunggyi MMR014D001  Lawksawk MMR014008 MMR014D001\n9  Shan (North)   MMR015  Kyaukme MMR015D003 Nawnghkio MMR015013 MMR015D003\n10 Shan (North)   MMR015  Kyaukme MMR015D003   Kyaukme MMR015012 MMR015D003\n       DT.y      TS.y TT_HOUSEHOLDS.x RADIO.x  TV.x LLPHONE.x MPHONE.x\n1   Kyaukme   Mongmit           13652    3907  7565       482     3559\n2  Taunggyi   Pindaya           17544    7324  8862       348     2849\n3  Taunggyi   Ywangan           18348    8890  4781       219     2207\n4  Taunggyi  Pinlaung           25504    5908 13816       728     6363\n5   Kyaukme    Mabein            8632    3880  6117       628     3389\n6  Taunggyi     Kalaw           41341   11607 25285      1739    16900\n7  Taunggyi     Pekon           20084    6399 10762       800     4315\n8  Taunggyi  Lawksawk           25957   10048 16353       818     8321\n9   Kyaukme Nawnghkio           32224   11257 17657      1239    10409\n10  Kyaukme   Kyaukme           28371    5985 17056      1123    10568\n   COMPUTER.x INTERNET.x RADIO_PR.x  TV_PR.x LLPHONE_PR.x MPHONE_PR.x\n1         166        321   286.1852 554.1313     35.30618    260.6944\n2         226        136   417.4647 505.1300     19.83584    162.3917\n3          81        152   484.5215 260.5734     11.93591    120.2856\n4         351        737   231.6499 541.7189     28.54454    249.4903\n5         142        165   449.4903 708.6423     72.75255    392.6089\n6        1225       1741   280.7624 611.6204     42.06478    408.7951\n7         381        316   318.6118 535.8494     39.83270    214.8476\n8         565        556   387.1017 630.0035     31.51366    320.5686\n9         508       1216   349.3359 547.9456     38.44960    323.0201\n10        878        936   210.9548 601.1773     39.58267    372.4930\n   COMPUTER_PR.x INTERNET_PR.x DT_PCODE.x.x   DT.x.x    TS.x.x TT_HOUSEHOLDS.y\n1       12.15939     23.513038   MMR015D003  Kyaukme   Mongmit           13652\n2       12.88190      7.751938   MMR014D001 Taunggyi   Pindaya           17544\n3        4.41465      8.284282   MMR014D001 Taunggyi   Ywangan           18348\n4       13.76255     28.897428   MMR014D001 Taunggyi  Pinlaung           25504\n5       16.45042     19.114921   MMR015D003  Kyaukme    Mabein            8632\n6       29.63160     42.113156   MMR014D001 Taunggyi     Kalaw           41341\n7       18.97032     15.733918   MMR014D001 Taunggyi     Pekon           20084\n8       21.76677     21.420041   MMR014D001 Taunggyi  Lawksawk           25957\n9       15.76465     37.735849   MMR015D003  Kyaukme Nawnghkio           32224\n10      30.94709     32.991435   MMR015D003  Kyaukme   Kyaukme           28371\n   RADIO.y  TV.y LLPHONE.y MPHONE.y COMPUTER.y INTERNET.y RADIO_PR.y  TV_PR.y\n1     3907  7565       482     3559        166        321   286.1852 554.1313\n2     7324  8862       348     2849        226        136   417.4647 505.1300\n3     8890  4781       219     2207         81        152   484.5215 260.5734\n4     5908 13816       728     6363        351        737   231.6499 541.7189\n5     3880  6117       628     3389        142        165   449.4903 708.6423\n6    11607 25285      1739    16900       1225       1741   280.7624 611.6204\n7     6399 10762       800     4315        381        316   318.6118 535.8494\n8    10048 16353       818     8321        565        556   387.1017 630.0035\n9    11257 17657      1239    10409        508       1216   349.3359 547.9456\n10    5985 17056      1123    10568        878        936   210.9548 601.1773\n   LLPHONE_PR.y MPHONE_PR.y COMPUTER_PR.y INTERNET_PR.y DT_PCODE.y.y   DT.y.y\n1      35.30618    260.6944      12.15939     23.513038   MMR015D003  Kyaukme\n2      19.83584    162.3917      12.88190      7.751938   MMR014D001 Taunggyi\n3      11.93591    120.2856       4.41465      8.284282   MMR014D001 Taunggyi\n4      28.54454    249.4903      13.76255     28.897428   MMR014D001 Taunggyi\n5      72.75255    392.6089      16.45042     19.114921   MMR015D003  Kyaukme\n6      42.06478    408.7951      29.63160     42.113156   MMR014D001 Taunggyi\n7      39.83270    214.8476      18.97032     15.733918   MMR014D001 Taunggyi\n8      31.51366    320.5686      21.76677     21.420041   MMR014D001 Taunggyi\n9      38.44960    323.0201      15.76465     37.735849   MMR015D003  Kyaukme\n10     39.58267    372.4930      30.94709     32.991435   MMR015D003  Kyaukme\n      TS.y.y TT_HOUSEHOLDS RADIO    TV LLPHONE MPHONE COMPUTER INTERNET\n1    Mongmit         13652  3907  7565     482   3559      166      321\n2    Pindaya         17544  7324  8862     348   2849      226      136\n3    Ywangan         18348  8890  4781     219   2207       81      152\n4   Pinlaung         25504  5908 13816     728   6363      351      737\n5     Mabein          8632  3880  6117     628   3389      142      165\n6      Kalaw         41341 11607 25285    1739  16900     1225     1741\n7      Pekon         20084  6399 10762     800   4315      381      316\n8   Lawksawk         25957 10048 16353     818   8321      565      556\n9  Nawnghkio         32224 11257 17657    1239  10409      508     1216\n10   Kyaukme         28371  5985 17056    1123  10568      878      936\n   RADIO_PR    TV_PR LLPHONE_PR MPHONE_PR COMPUTER_PR INTERNET_PR\n1  286.1852 554.1313   35.30618  260.6944    12.15939   23.513038\n2  417.4647 505.1300   19.83584  162.3917    12.88190    7.751938\n3  484.5215 260.5734   11.93591  120.2856     4.41465    8.284282\n4  231.6499 541.7189   28.54454  249.4903    13.76255   28.897428\n5  449.4903 708.6423   72.75255  392.6089    16.45042   19.114921\n6  280.7624 611.6204   42.06478  408.7951    29.63160   42.113156\n7  318.6118 535.8494   39.83270  214.8476    18.97032   15.733918\n8  387.1017 630.0035   31.51366  320.5686    21.76677   21.420041\n9  349.3359 547.9456   38.44960  323.0201    15.76465   37.735849\n10 210.9548 601.1773   39.58267  372.4930    30.94709   32.991435\n                         geometry\n1  MULTIPOLYGON (((96.96001 23...\n2  MULTIPOLYGON (((96.7731 21....\n3  MULTIPOLYGON (((96.78483 21...\n4  MULTIPOLYGON (((96.49518 20...\n5  MULTIPOLYGON (((96.66306 24...\n6  MULTIPOLYGON (((96.49518 20...\n7  MULTIPOLYGON (((97.14738 19...\n8  MULTIPOLYGON (((96.94981 22...\n9  MULTIPOLYGON (((96.75648 22...\n10 MULTIPOLYGON (((96.95498 22...\n```\n:::\n:::\n\n\nClass command also.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(shan_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"sf\"         \"data.frame\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ict)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n District Pcode     District Name      Township Pcode     Township Name     \n Length:55          Length:55          Length:55          Length:55         \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n Total households     Radio         Television    Land line phone \n Min.   : 3318    Min.   :  115   Min.   :  728   Min.   :  20.0  \n 1st Qu.: 8711    1st Qu.: 1260   1st Qu.: 3744   1st Qu.: 266.5  \n Median :13685    Median : 2497   Median : 6117   Median : 695.0  \n Mean   :18369    Mean   : 4487   Mean   :10183   Mean   : 929.9  \n 3rd Qu.:23471    3rd Qu.: 6192   3rd Qu.:13906   3rd Qu.:1082.5  \n Max.   :82604    Max.   :30176   Max.   :62388   Max.   :6736.0  \n  Mobile phone      Computer      Internet at home\n Min.   :  150   Min.   :  20.0   Min.   :   8.0  \n 1st Qu.: 2037   1st Qu.: 121.0   1st Qu.:  88.0  \n Median : 3559   Median : 244.0   Median : 316.0  \n Mean   : 6470   Mean   : 575.5   Mean   : 760.2  \n 3rd Qu.: 7177   3rd Qu.: 507.0   3rd Qu.: 630.5  \n Max.   :48461   Max.   :6705.0   Max.   :9746.0  \n```\n:::\n:::\n\n\nRunning this summary command lets us see the great variation in the data. Some are in the range of 10,000 or less, and some are as high as 62,000. This indicates we have to standardise this data for hierarchical clustering.\n\n#### 2.4 Pruning the data\n\nHere, we scale the data and rename it to more intuitive names.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nict_derived <- ict %>%\n  mutate(`RADIO_PR` = `Radio`/`Total households`*1000) %>%\n  mutate(`TV_PR` = `Television`/`Total households`*1000) %>%\n  mutate(`LLPHONE_PR` = `Land line phone`/`Total households`*1000) %>%\n  mutate(`MPHONE_PR` = `Mobile phone`/`Total households`*1000) %>%\n  mutate(`COMPUTER_PR` = `Computer`/`Total households`*1000) %>%\n  mutate(`INTERNET_PR` = `Internet at home`/`Total households`*1000) %>%\n  rename(`DT_PCODE` =`District Pcode`,`DT`=`District Name`,\n         `TS_PCODE`=`Township Pcode`, `TS`=`Township Name`,\n         `TT_HOUSEHOLDS`=`Total households`,\n         `RADIO`=`Radio`, `TV`=`Television`, \n         `LLPHONE`=`Land line phone`, `MPHONE`=`Mobile phone`,\n         `COMPUTER`=`Computer`, `INTERNET`=`Internet at home`) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ict_derived)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   DT_PCODE              DT              TS_PCODE              TS           \n Length:55          Length:55          Length:55          Length:55         \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n TT_HOUSEHOLDS       RADIO             TV           LLPHONE      \n Min.   : 3318   Min.   :  115   Min.   :  728   Min.   :  20.0  \n 1st Qu.: 8711   1st Qu.: 1260   1st Qu.: 3744   1st Qu.: 266.5  \n Median :13685   Median : 2497   Median : 6117   Median : 695.0  \n Mean   :18369   Mean   : 4487   Mean   :10183   Mean   : 929.9  \n 3rd Qu.:23471   3rd Qu.: 6192   3rd Qu.:13906   3rd Qu.:1082.5  \n Max.   :82604   Max.   :30176   Max.   :62388   Max.   :6736.0  \n     MPHONE         COMPUTER         INTERNET         RADIO_PR     \n Min.   :  150   Min.   :  20.0   Min.   :   8.0   Min.   : 21.05  \n 1st Qu.: 2037   1st Qu.: 121.0   1st Qu.:  88.0   1st Qu.:138.95  \n Median : 3559   Median : 244.0   Median : 316.0   Median :210.95  \n Mean   : 6470   Mean   : 575.5   Mean   : 760.2   Mean   :215.68  \n 3rd Qu.: 7177   3rd Qu.: 507.0   3rd Qu.: 630.5   3rd Qu.:268.07  \n Max.   :48461   Max.   :6705.0   Max.   :9746.0   Max.   :484.52  \n     TV_PR         LLPHONE_PR       MPHONE_PR       COMPUTER_PR    \n Min.   :116.0   Min.   :  2.78   Min.   : 36.42   Min.   : 3.278  \n 1st Qu.:450.2   1st Qu.: 22.84   1st Qu.:190.14   1st Qu.:11.832  \n Median :517.2   Median : 37.59   Median :305.27   Median :18.970  \n Mean   :509.5   Mean   : 51.09   Mean   :314.05   Mean   :24.393  \n 3rd Qu.:606.4   3rd Qu.: 69.72   3rd Qu.:428.43   3rd Qu.:29.897  \n Max.   :842.5   Max.   :181.49   Max.   :735.43   Max.   :92.402  \n  INTERNET_PR     \n Min.   :  1.041  \n 1st Qu.:  8.617  \n Median : 22.829  \n Mean   : 30.644  \n 3rd Qu.: 41.281  \n Max.   :117.985  \n```\n:::\n:::\n\n\n#### 2.5 EDA of the Data\n\nTo collate all the plots and display them together, we create the plots individually first.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nradio <- ggplot(data=ict_derived, \n             aes(x= `RADIO_PR`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\")\n\ntv <- ggplot(data=ict_derived, \n             aes(x= `TV_PR`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\")\n\nllphone <- ggplot(data=ict_derived, \n             aes(x= `LLPHONE_PR`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\")\n\nmphone <- ggplot(data=ict_derived, \n             aes(x= `MPHONE_PR`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\")\n\ncomputer <- ggplot(data=ict_derived, \n             aes(x= `COMPUTER_PR`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\")\n\ninternet <- ggplot(data=ict_derived, \n             aes(x= `INTERNET_PR`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\")\n\nggarrange(radio, tv, llphone, mphone, computer, internet, \n          ncol = 3, \n          nrow = 2)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex07_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n#### 2.6 EDA using Choropleth Map\n\nNow, we must join the data.\n\n\n::: {.cell freeze='true'}\n\n```{.r .cell-code}\nshan_sf <- left_join(shan_sf,\n                     ict_derived,\n                     by = c(\"TS_PCODE\" = \"TS_PCODE\"))\n\nwrite_rds(shan_sf, \"../../Data/Shan/shan_sf.rds\")\n```\n:::\n\n\n\n\n### 3.0 Hierarchical Clustering Analysis\n\n#### 3.1 Correlation Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncluster_vars.cor = cor(ict_derived[,12:17])\ncorrplot.mixed(cluster_vars.cor,\n         lower = \"ellipse\", \n               upper = \"number\",\n               tl.pos = \"lt\",\n               diag = \"l\",\n               tl.col = \"black\")\n```\n\n::: {.cell-output-display}\n![](In-class_Ex07_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nSince INTERNET_PR and COMPUTER_PR are highly correlated, we can remove one of them. We will remove INTERNET_PR.\n\n#### 3.2 Hierarchical Clustering\n\nWe must drop the geometry columns of the sf object as it will cause errors.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncluster_vars <- shan_sf %>%\n  st_set_geometry(NULL) %>%\n  select(\"TS.x\", \"RADIO_PR\", \"TV_PR\", \"LLPHONE_PR\", \"MPHONE_PR\", \"COMPUTER_PR\")\nhead(cluster_vars,10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        TS.x RADIO_PR    TV_PR LLPHONE_PR MPHONE_PR COMPUTER_PR\n1    Mongmit 286.1852 554.1313   35.30618  260.6944    12.15939\n2    Pindaya 417.4647 505.1300   19.83584  162.3917    12.88190\n3    Ywangan 484.5215 260.5734   11.93591  120.2856     4.41465\n4   Pinlaung 231.6499 541.7189   28.54454  249.4903    13.76255\n5     Mabein 449.4903 708.6423   72.75255  392.6089    16.45042\n6      Kalaw 280.7624 611.6204   42.06478  408.7951    29.63160\n7      Pekon 318.6118 535.8494   39.83270  214.8476    18.97032\n8   Lawksawk 387.1017 630.0035   31.51366  320.5686    21.76677\n9  Nawnghkio 349.3359 547.9456   38.44960  323.0201    15.76465\n10   Kyaukme 210.9548 601.1773   39.58267  372.4930    30.94709\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrow.names(cluster_vars) <- cluster_vars$\"TS.x\"\nhead(cluster_vars,10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               TS.x RADIO_PR    TV_PR LLPHONE_PR MPHONE_PR COMPUTER_PR\nMongmit     Mongmit 286.1852 554.1313   35.30618  260.6944    12.15939\nPindaya     Pindaya 417.4647 505.1300   19.83584  162.3917    12.88190\nYwangan     Ywangan 484.5215 260.5734   11.93591  120.2856     4.41465\nPinlaung   Pinlaung 231.6499 541.7189   28.54454  249.4903    13.76255\nMabein       Mabein 449.4903 708.6423   72.75255  392.6089    16.45042\nKalaw         Kalaw 280.7624 611.6204   42.06478  408.7951    29.63160\nPekon         Pekon 318.6118 535.8494   39.83270  214.8476    18.97032\nLawksawk   Lawksawk 387.1017 630.0035   31.51366  320.5686    21.76677\nNawnghkio Nawnghkio 349.3359 547.9456   38.44960  323.0201    15.76465\nKyaukme     Kyaukme 210.9548 601.1773   39.58267  372.4930    30.94709\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_ict <- select(cluster_vars, c(2:6))\nhead(shan_ict, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          RADIO_PR    TV_PR LLPHONE_PR MPHONE_PR COMPUTER_PR\nMongmit   286.1852 554.1313   35.30618  260.6944    12.15939\nPindaya   417.4647 505.1300   19.83584  162.3917    12.88190\nYwangan   484.5215 260.5734   11.93591  120.2856     4.41465\nPinlaung  231.6499 541.7189   28.54454  249.4903    13.76255\nMabein    449.4903 708.6423   72.75255  392.6089    16.45042\nKalaw     280.7624 611.6204   42.06478  408.7951    29.63160\nPekon     318.6118 535.8494   39.83270  214.8476    18.97032\nLawksawk  387.1017 630.0035   31.51366  320.5686    21.76677\nNawnghkio 349.3359 547.9456   38.44960  323.0201    15.76465\nKyaukme   210.9548 601.1773   39.58267  372.4930    30.94709\n```\n:::\n:::\n",
    "supporting": [
      "In-class_Ex07_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}